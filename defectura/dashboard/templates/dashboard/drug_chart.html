

{% extends 'base.html' %}

{% block title %} –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö {% endblock %}

{% block content %}
 <div class="col-md-12 mb-lg-0 mb-4">
            <div class="card mt-4 shadow-sm border-0">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h6 class="mb-0" style="color:white;">üìà –î–∏–Ω–∞–º–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ –ø—Ä–µ–ø–∞—Ä–∞—Ç—É: {{ drug_name }}</h6>


    </div>
                <div class="card-body ">
                    <div class="col-6">
                  <div class="row">


<canvas id="drugChart" width="600" height="300"></canvas>

                  </div>
                </div>


              </div>
            </div>


<script>
document.getElementById('file-upload-form').addEventListener('submit', function(event) {
    event.preventDefault(); // –û—Ç–º–µ–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã

    const formData = new FormData(this); // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
    const loader = document.getElementById('loader');
    const errorMessage = document.getElementById('error-message');

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∞–¥–µ—Ä
    loader.style.display = 'flex';
    errorMessage.style.display = 'none';

    fetch('/sort-file/', {
        method: 'POST',
        body: formData,
    })
    .then(response => response.blob())
    .then(blob => {
        // –°–∫—Ä—ã—Ç—å –ª–æ–∞–¥–µ—Ä
        loader.style.display = 'none';

        // –°–æ–∑–¥–∞—ë–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        const downloadLink = document.createElement('a');
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.download = 'sorted_file.xlsx';
        downloadLink.click();
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞:', error);
        loader.style.display = 'none';
        errorMessage.style.display = 'block';
        errorMessage.textContent = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞.';
    });
});
</script>
{% endblock %}

{% block scripts %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('drugChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ labels|safe }},
            datasets: [{
                label: '–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–ø—Ç–µ–∫ –±–µ–∑ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞',
                data: {{ data|safe }},
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2,
                tension: 0.3
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: '–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∞–ø—Ç–µ–∫'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: '–î–∞—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞'
                    }
                }
            }
        }
    });
</script>
{% endblock %}





